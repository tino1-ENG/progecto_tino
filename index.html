<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>MarketPro | Marketplace Completo</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Segoe UI,Arial}
body{background:#f4f6f8}

/* HEADER */
header{
    background:#111827;color:white;
    padding:15px 20px;
    display:flex;justify-content:space-between;align-items:center
}
header h1{font-size:20px}
header button{
    background:#2563eb;border:none;color:white;
    padding:8px 12px;border-radius:6px;margin-left:5px
}
.menu-btn{display:none;font-size:22px;cursor:pointer}

/* MOBILE MENU */
nav{display:flex;gap:8px}
@media(max-width:768px){
    nav{display:none;flex-direction:column;background:#111827;padding:10px}
    nav.show{display:flex}
    .menu-btn{display:block}
}

/* HERO */
.hero{
    background:linear-gradient(120deg,#2563eb,#1e40af);
    color:white;text-align:center;padding:40px 15px
}
.container{max-width:1200px;margin:auto;padding:20px}

/* FORMS */
.modal{
    display:none;position:fixed;top:0;left:0;
    width:100%;height:100%;
    background:rgba(0,0,0,.6);
    justify-content:center;align-items:center
}
.modal-content{
    background:white;padding:20px;border-radius:10px;
    width:90%;max-width:350px
}
.modal-content input, .modal-content button{
    width:100%;padding:10px;margin:6px 0
}

/* ADMIN */
.admin{
    display:none;background:white;
    padding:20px;border-radius:10px;margin-bottom:25px
}
.admin input,.admin button{
    width:100%;padding:10px;margin:6px 0
}

/* FILTERS */
.filters{
    display:flex;gap:10px;flex-wrap:wrap;margin-bottom:20px
}
.filters input,.filters select{
    padding:8px;border-radius:5px;border:1px solid #ccc
}

/* PRODUCTS */
.products{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
    gap:20px
}
.card{
    background:white;border-radius:12px;padding:12px;
    box-shadow:0 4px 12px rgba(0,0,0,.1)
}
.card img{
    width:100%;height:160px;object-fit:cover;border-radius:8px
}
.card span{color:#2563eb;font-weight:bold}
.card button{
    width:100%;margin-top:5px;padding:7px;border:none;border-radius:6px
}
.buy{background:#22c55e;color:white}
.edit{background:#f59e0b;color:white}
.delete{background:#ef4444;color:white}

/* CART */
.cart, .history{
    background:white;padding:15px;border-radius:10px;margin-top:25px
}
.cart-item{
    display:flex;justify-content:space-between;margin:6px 0
}

/* PAGINATION */
.pagination{
    display:flex;gap:8px;justify-content:center;margin:20px 0
}
.pagination button{
    background:#2563eb;color:white;border:none;
    padding:6px 12px;border-radius:5px
}
</style>
</head>

<body>

<header>
    <h1>MarketPro</h1>
    <div class="menu-btn" onclick="toggleMenu()">☰</div>
    <nav id="menu">
        <button onclick="openLogin()">Login</button>
        <button onclick="openRegister()">Cadastrar</button>
        <button onclick="logout()">Sair</button>
    </nav>
</header>

<section class="hero">
<h2>Marketplace Profissional</h2>
<p>Login • Carrinho • Histórico • Admin</p>
</section>

<div class="container">

<!-- ADMIN -->
<div class="admin" id="adminPanel">
<h3>Painel Admin</h3>
<input id="pNome" placeholder="Nome do produto">
<input id="pPreco" placeholder="Preço">
<input id="pCategoria" placeholder="Categoria">
<input type="file" id="pImagem">
<button onclick="salvarProduto()">Salvar Produto</button>
</div>

<!-- FILTERS -->
<div class="filters">
<input id="busca" placeholder="Buscar produto" oninput="aplicarFiltros()">
<select id="filtroCategoria" onchange="aplicarFiltros()">
<option value="">Todas categorias</option>
</select>
</div>

<!-- PRODUCTS -->
<div class="products" id="listaProdutos"></div>

<!-- PAGINATION -->
<div class="pagination" id="paginacao"></div>

<!-- CART -->
<div class="cart">
<h3>Carrinho</h3>
<div id="itensCarrinho"></div>
<p><strong>Total: R$ <span id="total">0</span></strong></p>
<button class="buy" onclick="checkout()">Finalizar Compra</button>
</div>

<!-- HISTORY -->
<div class="history">
<h3>Histórico de Compras</h3>
<div id="historico"></div>
</div>

</div>

<!-- LOGIN -->
<div class="modal" id="loginModal">
<div class="modal-content">
<h3>Login</h3>
<input id="loginEmail" placeholder="Email">
<input id="loginSenha" type="password" placeholder="Senha">
<button onclick="login()">Entrar</button>
</div>
</div>

<!-- REGISTER -->
<div class="modal" id="registerModal">
<div class="modal-content">
<h3>Cadastro</h3>
<input id="regNome" placeholder="Nome">
<input id="regEmail" placeholder="Email">
<input id="regSenha" type="password" placeholder="Senha">
<button onclick="register()">Cadastrar</button>
</div>
</div>

<script>
let produtos=JSON.parse(localStorage.produtos||"[]");
let usuarios=JSON.parse(localStorage.usuarios||"[]");
let compras=JSON.parse(localStorage.compras||"[]");
let usuarioLogado=JSON.parse(localStorage.usuarioLogado||"null");
let carrinho=[];
let editIndex=null;
let paginaAtual=1;
const porPagina=6;
let produtosFiltrados=[...produtos];

/* MENU */
function toggleMenu(){menu.classList.toggle("show")}

/* MODALS */
function openLogin(){loginModal.style.display="flex"}
function openRegister(){registerModal.style.display="flex"}
window.onclick=e=>{
    if(e.target.classList.contains("modal"))e.target.style.display="none";
}

/* AUTH */
function register(){
    usuarios.push({
        nome:regNome.value,
        email:regEmail.value,
        senha:regSenha.value,
        tipo:"cliente"
    });
    localStorage.usuarios=JSON.stringify(usuarios);
    alert("Cadastro realizado!");
    registerModal.style.display="none";
}
function login(){
    const u=usuarios.find(u=>u.email===loginEmail.value && u.senha===loginSenha.value);
    if(!u)return alert("Dados inválidos");
    usuarioLogado=u;
    localStorage.usuarioLogado=JSON.stringify(u);
    loginModal.style.display="none";
    adminPanel.style.display=u.tipo==="admin"?"block":"none";
    renderProdutos();
    renderHistorico();
}
function logout(){
    usuarioLogado=null;
    localStorage.removeItem("usuarioLogado");
    adminPanel.style.display="none";
}

/* IMAGE */
function lerImagem(file,cb){
    const r=new FileReader();
    r.onload=e=>cb(e.target.result);
    r.readAsDataURL(file);
}

/* CRUD */
function salvarProduto(){
    const salvar=img=>{
        const p={nome:pNome.value,preco:pPreco.value,categoria:pCategoria.value,imagem:img};
        editIndex==null?produtos.push(p):produtos[editIndex]=p;
        localStorage.produtos=JSON.stringify(produtos);
        editIndex=null;
        atualizarCategorias();aplicarFiltros();
    }
    if(pImagem.files[0])lerImagem(pImagem.files[0],salvar);
    else salvar(produtos[editIndex]?.imagem||"");
}
function editProduto(i){
    editIndex=i;
    pNome.value=produtos[i].nome;
    pPreco.value=produtos[i].preco;
    pCategoria.value=produtos[i].categoria;
}
function deleteProduto(i){
    produtos.splice(i,1);
    localStorage.produtos=JSON.stringify(produtos);
    aplicarFiltros();
}

/* FILTER */
function atualizarCategorias(){
    filtroCategoria.innerHTML='<option value="">Todas categorias</option>';
    [...new Set(produtos.map(p=>p.categoria))]
    .forEach(c=>filtroCategoria.innerHTML+=`<option>${c}</option>`);
}
function aplicarFiltros(){
    produtosFiltrados=produtos.filter(p=>
        p.nome.toLowerCase().includes(busca.value.toLowerCase()) &&
        (filtroCategoria.value===""||p.categoria===filtroCategoria.value)
    );
    paginaAtual=1;
    renderProdutos();
}

/* RENDER */
function renderProdutos(){
    listaProdutos.innerHTML="";
    produtosFiltrados.slice((paginaAtual-1)*porPagina,paginaAtual*porPagina)
    .forEach((p,i)=>{
        listaProdutos.innerHTML+=`
        <div class="card">
            <img src="${p.imagem||'https://via.placeholder.com/300'}">
            <h4>${p.nome}</h4>
            <p>${p.categoria}</p>
            <span>R$ ${p.preco}</span>
            <button class="buy" onclick="addCarrinho(${i})">Comprar</button>
            ${usuarioLogado?.tipo==="admin"?`
            <button class="edit" onclick="editProduto(${i})">Editar</button>
            <button class="delete" onclick="deleteProduto(${i})">Excluir</button>`:""}
        </div>`;
    });
    renderPaginacao();
}
function renderPaginacao(){
    paginacao.innerHTML="";
    for(let i=1;i<=Math.ceil(produtosFiltrados.length/porPagina);i++)
        paginacao.innerHTML+=`<button onclick="paginaAtual=${i};renderProdutos()">${i}</button>`;
}

/* CART */
function addCarrinho(i){carrinho.push(produtosFiltrados[i]);renderCarrinho()}
function renderCarrinho(){
    itensCarrinho.innerHTML="";
    let total=0;
    carrinho.forEach(p=>{
        total+=Number(p.preco);
        itensCarrinho.innerHTML+=`<div class="cart-item"><span>${p.nome}</span><span>R$ ${p.preco}</span></div>`;
    });
    document.getElementById("total").innerText=total.toFixed(2);
}
function checkout(){
    if(!usuarioLogado)return alert("Faça login para comprar");
    compras.push({
        email:usuarioLogado.email,
        data:new Date().toLocaleString(),
        itens:[...carrinho],
        total:document.getElementById("total").innerText
    });
    localStorage.compras=JSON.stringify(compras);
    carrinho=[];renderCarrinho();renderHistorico();
    alert("Compra realizada!");
}

/* HISTORY */
function renderHistorico(){
    historico.innerHTML="";
    compras.filter(c=>c.email===usuarioLogado?.email)
    .forEach(c=>{
        historico.innerHTML+=`
        <p><strong>${c.data}</strong> - R$ ${c.total}</p>`;
    });
}

atualizarCategorias();
aplicarFiltros();
if(usuarioLogado){
    adminPanel.style.display=usuarioLogado.tipo==="admin"?"block":"none";
    renderHistorico();
}
</script>

</body>
</html>
